<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Baza Danych Sklepu Motoryzacyjnego</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: monospace; padding: 20px; background: #f5f7fa; }
    h1 { text-align: center; margin-bottom: 20px; color: #2c3e50; }
    textarea { width: 100%; height: 120px; font-family: monospace; padding: 10px; }
    button { padding: 8px 15px; font-size: 14px; margin-top: 10px; cursor: pointer; }
    pre { background: #111; color: rgb(255, 255, 255); padding: 10px; overflow-x: auto; }
    span.row-even { background-color: rgba(255,255,255,0.05); display: block; }
    span.row-odd { background-color: rgba(255,255,255,0.15); display: block; }
    p.error { color: red; font-weight: bold; }
    p.info { color: #474747; }
  </style>
</head>
<body>

<h2>PostgreSQL (SELECT only)</h2>

<textarea id="sql">
SELECT * FROM klient
</textarea>

<br /><br />
<button onclick="runQuery()">Wykonaj</button>

<pre id="output"></pre>

<script>
  const SUPABASE_URL = 'https://oxkvhocijlqsoksoudqk.supabase.co'
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im94a3Zob2Npamxxc29rc291ZHFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzMTExODYsImV4cCI6MjA4Mzg4NzE4Nn0._nrW5li-PY_-odKkHjKukbUUInrjIdK1CccOnTox-oc'

  supabase = supabase.createClient(
    SUPABASE_URL,
    SUPABASE_ANON_KEY
  )

function padRight(str, len) {
  if (str === null || str === undefined) str = 'NULL'; // <-- tutaj obsługa NULL
  else str = String(str);
  return str + ' '.repeat(len - str.length);
}

function buildAsciiTable(data) {
  if (!data || data.length === 0) return 'Brak wyników';

  const headers = Object.keys(data[0]);
  // Obliczamy max szerokość dla każdej kolumny
  const colWidths = headers.map(h => {
    const maxInColumn = data.reduce((max, row) => Math.max(max, String(row[h]).length), 0);
    return Math.max(maxInColumn, h.length);
  });

  // Nagłówek
  let headerLine = '| ' + headers.map((h,i) => padRight(h, colWidths[i])).join(' | ') + ' |';
  let separator = '+-' + colWidths.map(w => '-'.repeat(w)).join('-+-') + '-+';

  // Wiersze
  let rows = data.map(row => 
    '| ' + headers.map((h,i) => padRight(row[h], colWidths[i])).join(' | ') + ' |'
  );

  return [separator, headerLine, separator, ...rows, separator].join('\n');
}

async function runQuery() {
  const sql = document.getElementById('sql').value.trim();
  const outputDiv = document.getElementById('output');
  outputDiv.textContent = 'Ładowanie...';

  const { data, error } = await supabase.rpc('run_select_query', { query: sql });

  if (error) {
    outputDiv.innerHTML = `<p class="error">Błąd: ${error.message}</p>`;
    return;
  }

  outputDiv.textContent = buildAsciiTable(data);
}
</script>

</body>
</html>